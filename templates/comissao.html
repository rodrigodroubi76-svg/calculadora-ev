{% extends "admin_layout.html" %}
{% block title %}Simulador de Comissão{% endblock %}

{% block content %}
<div class="container">
    <div class="form-card">
        <h1>Simulador de Modelo de Comissão</h1>
        <p>Calcule o faturamento e a comissão para o modelo "Energy as a Service", onde o cliente fornece o espaço e recebe uma % da receita.</p>
        
        <form method="POST">
            <div class="form-grid">
                <div>
                    <label for="veiculo">Veículo (Base para cálculo):</label>
                    <select id="veiculo" name="veiculo_id" required>
                        <option value="">-- Selecione um Veículo --</option>
                        {% for v in veiculos %}
                            <option value="{{ v.id }}" {% if 'veiculo_id' in request.form and v.id == request.form.veiculo_id|int %}selected{% endif %}>
                                {{ v.nome_completo }}
                            </option>
                        {% endfor %}
                    </select>
                </div>
                <div>
                    <label for="carregador">Carregador (Base para cálculo):</label>
                    <select id="carregador" name="carregador_id" required>
                        <option value="">-- Selecione um Carregador --</option>
                        {% for c in carregadores %}
                            <option value="{{ c.id }}" {% if 'carregador_id' in request.form and c.id == request.form.carregador_id|int %}selected{% endif %}>
                                {{ c.nome_completo }}
                            </option>
                        {% endfor %}
                    </select>
                </div>
                
                <div>
                    <label for="recargas_dia">Número Médio de Recargas/Dia (20-80%):</label>
                    <input type="number" step="0.1" id="recargas_dia" name="recargas_dia" value="{{ request.form['recargas_dia'] if 'recargas_dia' in request.form else '1.0' }}" required>
                </div>
                <div>
                    <label for="preco_venda_kwh">Preço de Venda do kWh (R$):</label>
                    <input type="number" step="0.01" id="preco_venda_kwh" name="preco_venda_kwh" value="{{ request.form['preco_venda_kwh'] if 'preco_venda_kwh' in request.form else '2.50' }}" required>
                </div>
                <div>
                    <label for="porcentagem_cliente">Comissão do Cliente (%):</label>
                    <input type="number" step="0.1" id="porcentagem_cliente" name="porcentagem_cliente" value="{{ request.form['porcentagem_cliente'] if 'porcentagem_cliente' in request.form else '15.0' }}" required>
                </div>
            </div>
            <button type="submit" style="margin-top: 20px;">Simular Faturamento</button>
        </form>
    </div>

    {% if resultado %}
    <div class="form-card">
        <h2>Resultado da Simulação de Comissão</h2>
        
        <h3>Dados Base (por recarga 20-80%)</h3>
        <p><strong>Energia Vendida por Recarga:</strong> {{ resultado.kwh_para_recarga | round(2) }} kWh</p>
        <p><strong>Receita Bruta por Recarga:</strong> R$ {{ resultado.receita_por_recarga | round(2) }}</p>
        
        <hr>
        <h3>Projeção de Faturamento (Baseado em {{ request.form.recargas_dia }} recargas/dia)</h3>
        <p><strong>Faturamento Bruto Mensal:</strong> R$ {{ resultado.faturamento_bruto_mensal | round(2) }}</p>
        
        <hr>
        <div class="form-grid">
            <div style="background: #f8d7da; padding: 15px; border-radius: 8px;">
                <h3 style="margin-top: 0;">Comissão do Cliente ({{ request.form.porcentagem_cliente }}%)</h3>
                <p><strong>Mensal: R$ {{ resultado.comissao_cliente_mensal | round(2) }}</strong></p>
                <p>Anual: R$ {{ (resultado.comissao_cliente_mensal * 12) | round(2) }}</p>
            </div>
            <div style="background: #d4edda; padding: 15px; border-radius: 8px;">
                <h3 style="margin-top: 0;">Receita da Operadora</h3>
                <p><strong>Mensal: R$ {{ resultado.faturamento_operadora_mensal | round(2) }}</strong></p>
                <p>Anual: R$ {{ (resultado.faturamento_operadora_mensal * 12) | round(2) }}</p>
            </div>
        </div>
    </div>
    {% endif %}

    {% if erro %}
    <div class="alert alert-error">
        {{ erro }}
    </div>
    {% endif %}
</div>
{% endblock %}