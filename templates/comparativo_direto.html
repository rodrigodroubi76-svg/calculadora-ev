{% extends "admin_layout.html" %}
{% block title %}Comparativo Direto{% endblock %}

{% block content %}
<div class="container">
    <div class="form-card">
        <h1>Comparativo Direto (1 Veículo x 1 Carregador)</h1>
        <p>Selecione um veículo, um carregador e seus dados de custo para ver um relatório focado.</p>
        
        <form method="POST">
            <div class="form-grid">
                <div>
                    <label for="veiculo">Veículo Elétrico:</label>
                    <select id="veiculo" name="veiculo_id" required>
                        <option value="">-- Selecione um Veículo --</option>
                        {% for v in veiculos %}
                            <option value="{{ v.id }}" {% if 'veiculo_id' in request.form and v.id == request.form.veiculo_id|int %}selected{% endif %}>
                                {{ v.nome_completo }}
                            </option>
                        {% endfor %}
                    </select>
                </div>
                <div>
                    <label for="carregador">Carregador:</label>
                    <select id="carregador" name="carregador_id" required>
                        <option value="">-- Selecione um Carregador --</option>
                        {% for c in carregadores %}
                            <option value="{{ c.id }}" {% if 'carregador_id' in request.form and c.id == request.form.carregador_id|int %}selected{% endif %}>
                                {{ c.nome_completo }}
                            </option>
                        {% endfor %}
                    </select>
                </div>
                <div>
                    <label for="custo_kwh">Custo do kWh (R$):</label>
                    <input type="number" step="0.01" id="custo_kwh" name="custo_kwh" value="{{ request.form['custo_kwh'] if 'custo_kwh' in request.form else '0.80' }}" required>
                </div>
                <div>
                    <label for="recargas_dia">Número Médio de Recargas por Dia:</label>
                   <input type="number" step="0.1" id="recargas_dia" name="recargas_dia" value="{{ request.form['recargas_dia'] if 'recargas_dia' in request.form else '1.0' }}" required>
                </div>
            </div>
            <button type="submit" style="margin-top: 20px;">Gerar Relatório</button>
        </form>
    </div>

    {% if resultado %}
    <div class="form-card">
        <h2>Resultado da Comparação</h2>
        <p><strong>Veículo:</strong> {{ resultado.veiculo.nome_completo }}</p>
        <p><strong>Carregador:</strong> {{ resultado.carregador.nome_completo }}</p>
        
        <hr>
        <h3>Desempenho da Recarga (20% a 80%)</h3>
        <p><strong>Potência Efetiva:</strong> {{ resultado.potencia_efetiva_kw | round(1) }} kW</p>
        <p><strong>Tempo de Recarga:</strong> {{ resultado.tempo_recarga_horas | round(2) }} horas</p>
        
        {% if resultado.is_over_24h %}
        <p style="color: #856404; background: #fff3cd; padding: 10px; border-radius: 4px;">
            <strong>⚠️ Atenção:</strong> O tempo total de recarga ({{ (resultado.tempo_recarga_horas * resultado.recargas_dia) | round(1) }}h) excede 24 horas por dia.
        </p>
        {% endif %}

        <hr>
        <h3>Estimativa de Custos (Baseado em {{ resultado.recargas_dia }} recargas/dia)</h3>
        <p><strong>Custo por Recarga:</strong> R$ {{ resultado.custos_gerais.custo_por_recarga | round(2) }}</Custo></p>
        <p><strong>Gasto Diário:</strong> R$ {{ resultado.custos_gerais.custo_diario | round(2) }}</p>
        <p><strong>Gasto Mensal (Média):</strong> R$ {{ resultado.custos_gerais.custo_mensal | round(2) }}</p>
    </div>
    {% endif %}
    
    {% if erro %}
    <div class="alert alert-error">
        {{ erro }}
    </div>
    {% endif %}

</div>
{% endblock %}